<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fast Food</title>
  <script src="https://cdn.jsdelivr.net/npm/rdflib/dist/rdflib.min.js"></script>
  <link rel="stylesheet" href="style.css">

</head>
<body>
  <header>Fast Food</header>
  <section class="intro">
    <h1>Welcome to Fast Food!</h1>
    <p>
      Discover a curated menu of delicious food items tailored to your dietary preferences.
      Whether you're vegan 🌱, lactose-intolerant 🥛, or just hungry 🍔, we've got something for you.
      Use the filters below to find your perfect meal!
    </p>
  </section>

  <section class="icon-legend">
    <h3>What Do the Icons Mean?</h3>
    <ul>
      <li><span class="icon">🌶️</span> Spiciness level (1–5)</li>
      <li><span class="icon">🥛</span> Contains dairy</li>
      <li><span class="icon">🥦</span> Vegan-friendly</li>
    </ul>
  </section>

  <div class="container">
    <div class="section">
      <label for="profile">Choose your dietary profile:</label>
      <select id="profile" onchange="showRecommendations()">
        <option value="none">None</option>
        <option value="vegan">Vegan</option>
        <option value="lactoseIntolerant">Lactose Intolerant</option>
      </select>
    </div>

    <div class="section">
      <h2>Search & Filter</h2>
      <input type="text" id="searchInput" placeholder="Search for food..." oninput="searchMenuItems()" />
      <div class="filter-group">
        <label><input type="checkbox" id="filterGlutenFree" onchange="searchMenuItems()" /> Gluten-Free</label>
        <label><input type="checkbox" id="filterVegan" onchange="searchMenuItems()" /> Vegan</label>
        <label><input type="checkbox" id="filterLowCal" onchange="searchMenuItems()" /> Under 300 Calories</label>
      </div>
    </div>

    <div class="section">
      <div id="menu-list" class="menu-grid"></div>
    </div>

    <div class="section">
      <h2>Recommended For You</h2>
      <div id="recommendation-list" class="menu-grid"></div>
    </div>

    <div class="section">
      <h2>Order</h2>
      <div class="order-row">
        <button onclick="validateOrder()">✅ Validate Order</button>
        <p id="validation-result"></p>
      </div>
    </div>
  </div>

  <script>
    const store = $rdf.graph();
    const fetcher = new $rdf.Fetcher(store, { fetch: window.fetch.bind(window) });
    const menuURL = new URL("menu.ttl", window.location.href).href;

    const ns = $rdf.Namespace("http://example.org/menu#");
    const RDF = $rdf.Namespace("http://www.w3.org/1999/02/22-rdf-syntax-ns#");

    const menuList = document.getElementById("menu-list");
    const resultEl = document.getElementById("validation-result");
    let selectedItems = [];
    let allItems = [];

    fetcher.load(menuURL).then(() => {
      allItems = store.each(undefined, RDF("type"), ns("FoodItem"));
      showRecommendations();
    });

    function renderMenu(items) {
      menuList.innerHTML = "";

      items.forEach(item => {
        const name = store.any(item, ns("name"));
        const ingredients = store.each(item, ns("hasIngredient"));
        const cal = store.any(item, ns("calories"));
        const spice = store.any(item, ns("spicyLevel"));
        const tags = store.each(item, ns("dietTag"));
        const hasCheese = store.any(item, ns("hasIngredient"), ns("Cheese"));

        const ingText = ingredients.map(i => i.value.split("#")[1]).join(", ");
        const fileName = name?.value.toLowerCase().replace(/ /g, "").replace(/[^a-z0-9]/g, "") + ".jpg";
        const imageUrl = `image/${fileName}`;

        let iconTagsArr = [];

        if (spice && parseInt(spice.value) > 0) {
          const level = Math.min(parseInt(spice.value), 5);
          iconTagsArr.push("🌶️".repeat(level));
        }
        if (tags.some(t => t.value.endsWith("containsDairy"))) iconTagsArr.push("🥛");
        if (tags.some(t => t.value.endsWith("vegan"))) iconTagsArr.push("🥦");

        const iconTags = iconTagsArr.join(" ");

        
        const card = document.createElement("div");
        card.className = "menu-card";
        card.innerHTML = `
          <img src="${imageUrl}" alt="${name?.value}" onerror="this.src='image/default.jpg'" />
          <h3>${name?.value}</h3>
          <p><strong>Calories:</strong> ${cal?.value}</p>
          <p class="icon-badge-row">${iconTags}</p>
          <p class="ingredient-list"><strong>Ingredients:</strong> ${ingText}</p>
          <label><input type="checkbox" value="${item.value}" onchange="toggleSelect(this, '${item.value}')"> Select</label>
        `;
        menuList.appendChild(card);
      });
      if (items.length > 0) {
        menuList.scrollIntoView({ behavior: 'smooth' });
      }
    }

    function toggleSelect(checkbox, uri) {
        const item = $rdf.sym(uri);
        const hasCheese = store.any(item, ns("hasIngredient"), ns("Cheese"));
        const hasMilk = store.any(item, ns("hasIngredient"), ns("Milk"));
        const selectedIndex = selectedItems.findIndex(i => i.uri === uri);

        if (checkbox.checked && selectedIndex === -1) {
            selectedItems.push({ uri, hasCheese, hasMilk });
        } else if (!checkbox.checked && selectedIndex !== -1) {
            selectedItems.splice(selectedIndex, 1);
        }
    }

    function validateOrder() {
        const profile = document.getElementById("profile").value;
        let warnings = [];

        if (profile === "lactoseIntolerant") {
            selectedItems.forEach(item => {
              const sym = $rdf.sym(item.uri);
              const hasCheese = store.any(sym, ns("hasIngredient"), ns("Cheese"));
              const hasMilk = store.any(sym, ns("hasIngredient"), ns("Milk"));

              if (hasCheese || hasMilk) {
                const name = store.any(sym, ns("name"))?.value || item.uri.split("#")[1];
                warnings.push("❌ " + name + " contains milk or cheese.");
              }
            });
        }

        if (warnings.length > 0) {
            resultEl.innerHTML = '<span class="warning">' + warnings.join("<br>") + '</span>';
        } else {
            resultEl.innerHTML = '<span style="color:green; font-weight:bold">✅ Order is valid.</span>';
        }
    }

    function searchMenuItems() {
      const searchText = document.getElementById("searchInput").value.toLowerCase().trim();
      const glutenFree = document.getElementById("filterGlutenFree").checked;
      const vegan = document.getElementById("filterVegan").checked;
      const lowCal = document.getElementById("filterLowCal").checked;

      // If nothing typed and no filters checked, clear results
      if (!searchText && !glutenFree && !vegan && !lowCal) {
        renderMenu([]);
        return;
      }

      const filtered = allItems.filter(item => {
        const nameNode = store.any(item, ns("name"));
        const name = nameNode ? nameNode.value.toLowerCase() : "";
        const tags = store.each(item, ns("dietTag"));
        const cal = store.any(item, ns("calories"));

        // searchText: match name
        if (searchText && (!name || !name.includes(searchText))) return false;

        // Filters: match if they are checked
        if (glutenFree && !tags.some(t => t.value.endsWith("glutenFree"))) return false;
        if (vegan && !tags.some(t => t.value.endsWith("vegan"))) return false;
        if (lowCal && parseInt(cal?.value || "1000") >= 300) return false;

        return true;
      });

      renderMenu(filtered);
    }

    function showRecommendations() {
      const profile = document.getElementById("profile").value;

      const recommendedItems = allItems.filter(item => {
        const tags = store.each(item, ns("dietTag"));
        if (profile === "vegan") {
          return tags.some(t => t.value.endsWith("vegan"));
        }
        if (profile === "lactoseIntolerant") {
          return !tags.some(t => t.value.endsWith("containsDairy"));
        }
        return true;
      });

      renderRecommendations(recommendedItems);
    }

    function renderRecommendations(items) {
      const recList = document.getElementById("recommendation-list");
      recList.innerHTML = "";

      // Shuffle and pick 3 random items
      const shuffled = items.sort(() => 0.5 - Math.random()).slice(0, 4);

      shuffled.forEach(item => {
        const name = store.any(item, ns("name"));
        const ingredients = store.each(item, ns("hasIngredient"));
        const cal = store.any(item, ns("calories"));
        const spice = store.any(item, ns("spicyLevel"));
        const tags = store.each(item, ns("dietTag"));

        const ingText = ingredients.map(i => i.value.split("#")[1]).join(", ");
        const fileName = name?.value.toLowerCase().replace(/ /g, "").replace(/[^a-z0-9]/g, "") + ".jpg";
        const imageUrl = `image/${fileName}`;

        let iconTags = tags.map(t => {
          if (t.value.endsWith("vegan")) return "🥦";
          if (t.value.endsWith("containsDairy")) return "🥛";
          if (t.value.endsWith("glutenFree")) return "✅";
          return "";
        }).join(" ");
        if (spice && parseInt(spice.value) > 3) iconTags += " 🌶️";

        const card = document.createElement("div");
        card.className = "menu-card";
        card.innerHTML = `
          <img src="${imageUrl}" alt="${name?.value}" onerror="this.src='image/default.jpg'" />
          <h3>${name?.value}</h3>
          <p><strong>Calories:</strong> ${cal?.value}</p>
          <p class="spicy-badge">
            🌶️ ${spice?.value} &nbsp; ${iconTags}
          </p>
          <p class="ingredient-list"><strong>Ingredients:</strong> ${ingText}</p>
        `;
        recList.appendChild(card);
      });
    }



  </script>
</body>
</html>